rock.namespace("chart");chart.constants={MAIN_WINDOW:"MAIN_WINDOW"};rock.namespace("chart");chart.Data=function(a,b,c,d,e,f,g,j,k){this.title=a;this.domain=b;this.units=c;this.values=d;this.beginRange=e;this.endRange=f;this.roundUnitGuideLines=g;this.roundUnitGuideLineLabels=j;this.doStartAnimation=k;this.titleColor=this.titleFont=this.axisLineColor=this.selectedBarColor=this.barColor=this.axisFontColor=this.axisFont=this.fontColor=this.font=this.backgroundColor=null};chart.Data.prototype.getTitle=function(){return this.title};
chart.Data.prototype.setTitle=function(a){this.title=a};chart.Data.prototype.getUnits=function(){return this.units};chart.Data.prototype.setUnits=function(a){this.units=a};chart.Data.prototype.getDomain=function(){return this.domain};chart.Data.prototype.setDomain=function(a){this.domain=a};chart.Data.prototype.getValues=function(){return this.values};chart.Data.prototype.setValues=function(a){this.values=a};chart.Data.prototype.getBeginRange=function(){return this.beginRange};
chart.Data.prototype.setBeginRange=function(a){this.beginRange=a};chart.Data.prototype.getEndRange=function(){return this.endRange};chart.Data.prototype.setEndRange=function(a){this.endRange=a};chart.Data.prototype.getRoundUnitGuideLines=function(){return this.roundUnitGuideLines};chart.Data.prototype.setRoundUnitGuideLines=function(a){this.roundUnitGuideLines=a};chart.Data.prototype.getRoundUnitGuideLineLabels=function(){return this.roundUnitGuideLineLabels};
chart.Data.prototype.setRoundUnitGuideLineLabels=function(a){this.roundUnitGuideLineLabels=a};chart.Data.prototype.getDoStartAnimation=function(){return this.doStartAnimation};chart.Data.prototype.setDoStartAnimation=function(a){this.doStartAnimation=a};chart.Data.prototype.getBackgroundColor=function(){return this.backgroundColor};chart.Data.prototype.setBackgroundColor=function(a){this.backgroundColor=a};chart.Data.prototype.getFont=function(){return this.font};
chart.Data.prototype.setFont=function(a){this.font=a};chart.Data.prototype.getFontColor=function(){return this.fontColor};chart.Data.prototype.setFontColor=function(a){this.fontColor=a};chart.Data.prototype.getAxisFont=function(){return this.axisFont};chart.Data.prototype.setAxisFont=function(a){this.axisFont=a};chart.Data.prototype.getAxisFontColor=function(){return this.axisFontColor};chart.Data.prototype.setAxisFontColor=function(a){this.axisFontColor=a};chart.Data.prototype.getBarColor=function(){return this.barColor};
chart.Data.prototype.setBarColor=function(a){this.barColor=a};chart.Data.prototype.getSelectedBarColor=function(){return this.selectedBarColor};chart.Data.prototype.setSelectedBarColor=function(a){this.selectedBarColor=a};chart.Data.prototype.getAxisLineColor=function(){return this.axisLineColor};chart.Data.prototype.setAxisLineColor=function(a){this.axisLineColor=a};chart.Data.prototype.getTitleFont=function(){return this.titleFont};chart.Data.prototype.setTitleFont=function(a){this.titleFont=a};
chart.Data.prototype.getTitleColor=function(){return this.titleColor};chart.Data.prototype.setTitleColor=function(a){this.titleColor=a};rock.namespace("chart");
chart.BarChartComponent=function(a){rock.super_(this,[a]);this.height=this.width=rock.window.component.Component.AUTO_SIZE;this.data=null;this.validData=!1;this.addEventListener(rock.constants.ROCK_EVENT_MOUSE_MOVE,rock.createEventHandler(this,this.handleOnMouseMove));this.backgroundColor=new rock.graphics.Color(245,245,255);this.TOP_AXIS_MARGIN=10;this.BOTTOM_AXIS_MARGIN=15;this.RIGHT_AXIS_MARGIN=this.LEFT_AXIS_MARGIN=10;this.SELECTED_BAR_LABEL_MARGIN=this.UNIT_LINE_GUIDES_COUNT=this.UNIT_GUIDE_LABEL_MARGIN=
this.DOMAIN_LABEL_MARGIN=this.Y_AXIS_LABEL=this.X_AXIS_LABEL=this.RANGE_MARGIN=5;this.UNIT_GUIDE_LINES_LABEL_DECIMALS=2;this.AUTO_ROUND="auto";this.ANIMATION_TIME=500;this.INVALID_DATA_MESSAGE="Invalid value";this.yAxisLabel=this.xAxisLabel=this.units=this.domain=this.title=null;this.axisLineWidth=2;this.axisLineColor=new rock.graphics.Color(0,0,0);this.axisLabelFont=new rock.graphics.Font("Arial",14);this.axisLabelColor=new rock.graphics.Color(0,0,0);this.barColor=new rock.graphics.Color(255,0,0);
this.selectedBarColor=new rock.graphics.Color(150,0,0);this.domainLabelFont=new rock.graphics.Font("Arial",12);this.domainLabelColor=new rock.graphics.Color(0,0,0);this.unitLineGuidesWidth=1;this.unitLineGuidesColor=new rock.graphics.Color(0,0,0,128);this.unitLineGuidesLabelFont=new rock.graphics.Font("Arial",12);this.unitLineGuidesLabelColor=new rock.graphics.Color(0,0,0);this.titleFont=new rock.graphics.Font("Arial",20);this.titleColor=new rock.graphics.Color(0,0,0);this.selectedBarLabelFont=new rock.graphics.Font("Arial",
12);this.selectedBarLabelColor=new rock.graphics.Color(0,0,0);this.roundUnitGuideLines=this.AUTO_ROUND;this.roundUnitGuideLineLabels=!1;this.currentAnimationTime=this.endAnimationTime=this.startAnimationTime=this.selectedBarLabelWidthHeight=this.selectedBarLabelPosition=this.currentSelectedBar=this.domainValues=this.domainLabels=this.countValues=this.beginRange=this.rangeDifference=this.yAxisSize=this.xAxisSize=this.titlePosition=this.unitLineGuidesLabels=this.unitLineGuides=this.domainBarLabelsPosition=
this.domainBarLabels=this.bars=this.yAxisLabelPosition=this.xAxisLabelPosition=this.yAxisEndPoint=this.xAxisEndPoint=this.axisStartPoint=null;this.isInAnimation=!1};rock.extends_(chart.BarChartComponent,rock.window.component.Component);
chart.BarChartComponent.prototype.handleOnMouseMove=function(a){if(this.validData){a=new rock.geometry.Point2(a.getX(),a.getY());var b=this.bars,c,d,e=this.countValues,f=-1;for(c=0;c<e;c++)if(d=b[c],d.intersectWithPoint(a)){f=c;break}f!=this.currentSelectedBar&&(this.currentSelectedBar=f,this.computeSelectedBarLabel(),this.window.redraw())}};
chart.BarChartComponent.prototype.roundIfNecessary=function(a,b){return this.roundUnitGuideLines?"FLOOR"===b?Math.floor(a):"CEIL"===b?Math.ceil(a):Math.round(a):a};
chart.BarChartComponent.prototype.computeSelectedBarLabel=function(){var a=this.currentSelectedBar,b=this.bars[a],c=this.domainValues[a];if(!rock.util.JsUtils.isNullOrUndefined(b)){var a=rock.util.TextUtils.measureTextWidth(c,this.selectedBarLabelFont),c=rock.util.TextUtils.measureTextHeight(c,this.selectedBarLabelFont),d=b.getXMax()-(b.getXMax()-b.getXMin())/2-a/2,b=b.getYMin()-this.SELECTED_BAR_LABEL_MARGIN-c;this.selectedBarLabelPosition=new rock.geometry.Point2(d,b);this.selectedBarLabelWidthHeight=
{width:a,height:c}}};
chart.BarChartComponent.prototype.computeCommonValues=function(a){var b,c,d=null,e=null,f=a.getValues(),g=0,j=[],k=[];for(b in f)if(f.hasOwnProperty(b)){c=f[b];if(!rock.util.JsUtils.isNumerical(c))throw new rock.error.RockError(this.INVALID_DATA_MESSAGE);c=parseFloat(c);null==d&&(e=d=c);c<d&&(d=c);c>e&&(e=c);k.push(b);j.push(c);g++}b=a.getEndRange();!rock.util.JsUtils.isNullOrUndefined(b)&&b>e&&(e=b);a=a.getBeginRange();!rock.util.JsUtils.isNullOrUndefined(a)&&(a<d&&a<e)&&(d=a);c=e-d;this.roundUnitGuideLines===
this.AUTO_ROUND&&(this.roundUnitGuideLines=c<2*this.UNIT_LINE_GUIDES_COUNT+2?!1:!0);c=this.RANGE_MARGIN*c/100;rock.util.JsUtils.isNullOrUndefined(a)&&(d-=c);rock.util.JsUtils.isNullOrUndefined(b)&&(e+=c);e=this.roundIfNecessary(e,"CEIL");d=this.roundIfNecessary(d,"FLOOR");this.rangeDifference=e-d;this.beginRange=d;this.countValues=g;this.domainLabels=k;this.domainValues=j;this.currentSelectedBar=-1};
chart.BarChartComponent.prototype.computeAxisLine=function(){var a=this.computedHeight,b=this.computedWidth,c=Math.round(this.LEFT_AXIS_MARGIN*b/100),d=Math.round(this.RIGHT_AXIS_MARGIN*b/100),e=Math.round(this.TOP_AXIS_MARGIN*a/100),f=Math.round(this.BOTTOM_AXIS_MARGIN*a/100);this.axisStartPoint=new rock.geometry.Point2(c,a-f);this.xAxisEndPoint=new rock.geometry.Point2(b-d,a-f);this.yAxisEndPoint=new rock.geometry.Point2(c,e);this.xAxisSize=this.xAxisEndPoint.getX()-this.axisStartPoint.getX();this.yAxisSize=
this.axisStartPoint.getY()-this.yAxisEndPoint.getY()};
chart.BarChartComponent.prototype.computeAxisLabels=function(){var a=this.axisStartPoint,b=this.yAxisEndPoint,c=this.domain,d=this.computedWidth/2-rock.util.TextUtils.measureTextWidth(c,this.axisLabelFont)/2,a=a.getY()+this.DOMAIN_LABEL_MARGIN+rock.util.TextUtils.measureTextHeight(c,this.domainLabelFont)+this.X_AXIS_LABEL;this.xAxisLabelPosition=new rock.geometry.Point2(Math.round(d),Math.round(a));this.xAxisLabel=c;c=this.units;d=b.getX()-rock.util.TextUtils.measureTextWidth(c,this.axisLabelFont)/
2;b=b.getY()-rock.util.TextUtils.measureTextHeight(c,this.axisLabelFont)-this.Y_AXIS_LABEL-rock.util.TextUtils.measureTextHeight("00",this.unitLineGuidesLabelFont)/2;this.yAxisLabelPosition=new rock.geometry.Point2(Math.round(d),Math.round(b));this.yAxisLabel=c};
chart.BarChartComponent.prototype.computeBarsAndDomainLabels=function(){var a=this.axisStartPoint,b=this.yAxisSize,c=this.rangeDifference,d=this.beginRange,e=this.countValues,f=this.domainLabels,g=this.domainValues,j=[],k=this.xAxisSize/(3*e+1),n,p,q,l=a.getY(),h;for(h=0;h<e;h++)n=a.getX()+k+3*h*k,p=n+2*k,q=g[h]-d,q=b*q/c,q=a.getY()-q,j.push(new rock.geometry.Rectangle(Math.round(n),Math.round(q),Math.round(p),Math.round(l)));this.bars=j;b=this.domainLabelFont;c=[];g=a.getY()+this.DOMAIN_LABEL_MARGIN;
for(h=0;h<e;h++)j=f[h],d=a.getX()+2*k+3*h*k,j=rock.util.TextUtils.measureTextWidth(j,b)/2,c.push(new rock.geometry.Point2(Math.round(d-j),Math.round(g)));this.domainBarLabels=f;this.domainBarLabelsPosition=c};
chart.BarChartComponent.prototype.computeUnitLabelsAndGuideReferenceLine=function(){var a=this.axisStartPoint,b=this.xAxisSize,c=this.yAxisSize,d=this.rangeDifference,e=this.beginRange,f=this.UNIT_LINE_GUIDES_COUNT,g=d/f,j=this.unitLineGuidesLabelFont,k=[],n=[],p=a.getX(),q=this.roundUnitGuideLines,l,h,m,r,s;for(s=0;s<=f;s++)m=this.roundIfNecessary(s*g),h=c*m/d,h=Math.round(a.getY()-h),l=new rock.geometry.Point2(p,h),r=new rock.geometry.Point2(p+b,h),l={beginPoint:l,endPoint:r},k.push(l),m=e+m,l=
this.UNIT_GUIDE_LINES_LABEL_DECIMALS,q||(this.roundUnitGuideLineLabels&&(l=0),m=rock.util.JsUtils.round(m,l)),l=rock.util.TextUtils.measureTextWidth(m,j),r=rock.util.TextUtils.measureTextHeight(m,j),h={value:m,position:new rock.geometry.Point2(Math.round(p-this.UNIT_GUIDE_LABEL_MARGIN-l),Math.round(h-r/2))},n.push(h);k.shift();this.unitLineGuides=k;this.unitLineGuidesLabels=n};
chart.BarChartComponent.prototype.computeTitle=function(){var a=this.title,b=this.computedWidth/2-rock.util.TextUtils.measureTextWidth(a,this.titleFont)/2,a=this.yAxisEndPoint.getY()/2-rock.util.TextUtils.measureTextHeight(a,this.titleFont)/2;this.titlePosition=new rock.geometry.Point2(Math.round(b),Math.round(a))};
chart.BarChartComponent.prototype.computeBarChart=function(a){this.computeCommonValues(a);this.computeAxisLine();this.computeAxisLabels();this.computeBarsAndDomainLabels();this.computeUnitLabelsAndGuideReferenceLine();this.computeTitle()};chart.BarChartComponent.prototype.getBarHeight=function(a){var b=this.endAnimationTime-this.startAnimationTime,c=this.currentAnimationTime-this.startAnimationTime;return this.isInAnimation?c*a/b:a};
chart.BarChartComponent.prototype.drawBarsAndDomainLabels=function(a){var b,c,d,e,f,g,j=this.bars,k=this.currentSelectedBar;d=j.length;var n=this.domainLabelFont,p=this.domainLabelColor;for(b=0;b<d;b++)c=j[b],e=this.barColor,b===k&&(e=this.selectedBarColor),f=this.getBarHeight(c.getYMax()-c.getYMin()),g=c.getYMax()-c.getYMin()-f,a.drawRectangle(c.getXMin(),c.getYMin()+g,c.getXMax()-c.getXMin(),f,e);c=this.domainBarLabels;e=this.domainBarLabelsPosition;for(b=0;b<d;b++)f=c[b],g=e[b],a.drawText(f,g.getX(),
g.getY(),n,p)};chart.BarChartComponent.prototype.drawLabelSelectedBar=function(a){var b=this.currentSelectedBar;if(-1!=b){var c=this.selectedBarLabelPosition,d=this.selectedBarLabelWidthHeight;a.drawRectangle(c.getX()-2,c.getY(),d.width+4,d.height,this.backgroundColor);a.drawText(this.domainValues[b],c.getX(),c.getY(),this.selectedBarLabelFont,this.selectedBarLabelColor)}};
chart.BarChartComponent.prototype.drawUnitLabelsAndGuideReferenceLine=function(a){var b=this.unitLineGuides,c=this.unitLineGuidesLabels,d,e=b.length,f=c.length,g;for(g=0;g<e;g++)d=b[g],a.drawLine(d.beginPoint.getX(),d.beginPoint.getY(),d.endPoint.getX(),d.endPoint.getY(),this.unitLineGuidesWidth,this.unitLineGuidesColor);for(g=0;g<f;g++)b=c[g],a.drawText(b.value,b.position.getX(),b.position.getY(),this.unitLineGuidesLabelFont,this.unitLineGuidesLabelColor)};
chart.BarChartComponent.prototype.drawAxisLine=function(a){var b=this.axisStartPoint,c=this.xAxisEndPoint,d=this.yAxisEndPoint,e=this.axisLineWidth,f=this.axisLineColor;a.drawLine(b.getX(),b.getY(),c.getX(),c.getY(),e,f);a.drawLine(b.getX(),b.getY(),d.getX(),d.getY(),e,f)};
chart.BarChartComponent.prototype.drawAxisLabels=function(a){var b=this.xAxisLabelPosition,c=this.yAxisLabelPosition,d=this.axisLabelFont,e=this.axisLabelColor;a.drawText(this.xAxisLabel,b.getX(),b.getY(),d,e);a.drawText(this.yAxisLabel,c.getX(),c.getY(),d,e)};chart.BarChartComponent.prototype.drawTitle=function(a){a.drawText(this.title,this.titlePosition.getX(),this.titlePosition.getY(),this.titleFont,this.titleColor)};
chart.BarChartComponent.prototype.draw=function(a){this.validData&&(a.drawRectangle(this.x,this.y,this.computedWidth,this.computedHeight,this.backgroundColor),this.drawBarsAndDomainLabels(a),this.drawUnitLabelsAndGuideReferenceLine(a),this.drawLabelSelectedBar(a),this.drawAxisLine(a),this.drawAxisLabels(a),this.drawTitle(a))};
chart.BarChartComponent.prototype.animate=function(){this.currentAnimationTime=(new Date).getTime();this.currentAnimationTime>this.endAnimationTime&&(rock.timer.stop(),rock.timer.unregisterTimerFunction(this.animate),this.isInAnimation=!1);this.window.redraw()};
chart.BarChartComponent.prototype.updateStyles=function(a){var b=a.getBackgroundColor();rock.util.JsUtils.isNullOrUndefined(b)||(this.backgroundColor=b);b=a.getFont();rock.util.JsUtils.isNullOrUndefined(b)||(this.axisLabelFont=b);b=a.getFontColor();rock.util.JsUtils.isNullOrUndefined(b)||(this.axisLabelColor=b);b=a.getAxisFont();rock.util.JsUtils.isNullOrUndefined(b)||(this.unitLineGuidesLabelFont=this.selectedBarLabelFont=this.domainLabelFont=b);b=a.getAxisFontColor();rock.util.JsUtils.isNullOrUndefined(b)||
(this.unitLineGuidesLabelColor=this.selectedBarLabelColor=this.domainLabelColor=b);b=a.getBarColor();rock.util.JsUtils.isNullOrUndefined(b)||(this.barColor=b);b=a.getSelectedBarColor();rock.util.JsUtils.isNullOrUndefined(b)||(this.selectedBarColor=b);b=a.getAxisLineColor();rock.util.JsUtils.isNullOrUndefined(b)||(this.axisLineColor=b,this.unitLineGuidesColor=new rock.graphics.Color(b.getRed(),b.getGreen(),b.getBlue(),128));b=a.getTitleFont();rock.util.JsUtils.isNullOrUndefined(b)||(this.titleFont=
b);a=a.getTitleColor();rock.util.JsUtils.isNullOrUndefined(a)||(this.titleColor=a)};chart.BarChartComponent.prototype.updateSize=function(){this.computedWidth=this.width===rock.window.component.Component.AUTO_SIZE?this.window.getWindowSystem().getWidth():this.width;this.computedHeight=this.height===rock.window.component.Component.AUTO_SIZE?this.window.getWindowSystem().getHeight():this.height};
chart.BarChartComponent.prototype.updateComponent=function(){this.updateSize();var a=this.data,b=a.getRoundUnitGuideLines();rock.util.JsUtils.isNullOrUndefined(b)&&(b=this.AUTO_ROUND);this.roundUnitGuideLines=b;b=a.getRoundUnitGuideLineLabels();rock.util.JsUtils.isNullOrUndefined(b)||(this.roundUnitGuideLineLabels=b);this.title=a.getTitle();this.domain=a.getDomain();this.units=a.getUnits();this.updateStyles(a);this.computeBarChart(a)};
chart.BarChartComponent.prototype.startDrawing=function(){var a=this.data.getDoStartAnimation();rock.util.JsUtils.isNullOrUndefined(a)&&(a=!0);a?(this.startAnimationTime=(new Date).getTime(),this.endAnimationTime=this.startAnimationTime+this.ANIMATION_TIME,this.isInAnimation=!0,rock.timer.registerTimerFunction(this,this.animate,[]),rock.timer.start()):this.window.redraw()};
chart.BarChartComponent.prototype.setData=function(a){!rock.isNullOrUndefined(a)&&rock.instanceof_(a,chart.Data)&&(this.data=a,this.validData=!0,this.updateComponent(),this.startDrawing())};rock.namespace("chart");chart.MainWindow=function(a){rock.super_(this,arguments);this.barChartComponent=null;this.backgroundColor=new rock.graphics.Color(245,245,255);this.addComponents()};rock.extends_(chart.MainWindow,rock.window.Window);chart.MainWindow.prototype.addComponents=function(){var a=new chart.BarChartComponent(this);a.setId("barChart");a.setX(0);a.setY(0);this.addComponent(a);this.barChartComponent=a};chart.MainWindow.prototype.setData=function(a){this.barChartComponent.setData(a)};rock.namespace("chart");chart.Chart=function(a,b,c){a=new rock.app.InitApplicationParams(a,b,c,rock.constants.CONTEXT_CANVAS_2D,null);rock.super_(this,[a])};rock.extends_(chart.Chart,rock.app.Application);chart.Chart.prototype.start=function(){var a=new chart.MainWindow(this.windowSystem);this.windowSystem.registerWindow(chart.constants.MAIN_WINDOW,a);this.windowSystem.setCurrentWindow(a)};chart.Chart.prototype.setData=function(a){this.windowSystem.getWindow(chart.constants.MAIN_WINDOW).setData(a)};
